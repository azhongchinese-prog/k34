<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ghép từ Tiếng Trung - Trò chơi học tập cho người Việt</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #06d6a0;
            --accent-color: #118ab2;
            --background-color: #fff8e1;
            --text-color: #333;
            --light-color: #fff;
            --shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            --bubble-shadow: inset 0 -8px 10px rgba(0, 0, 0, 0.2),
                              inset 0 8px 10px rgba(255, 255, 255, 0.7),
                              0 10px 20px rgba(0, 0, 0, 0.3);
            --bubble-height-desktop: 150px;
            --bubble-height-tablet: 130px;
            --bubble-height-mobile: 110px;
            --font-size-large: 1.8rem;
            --font-size-medium: 1.5rem;
            --font-size-small: 1.2rem;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--text-color);
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
            padding: 20px 10px;
        }
        
        h1 {
            color: var(--primary-color);
            font-size: clamp(2rem, 8vw, 3.5rem);
            text-shadow: 3px 3px 0 #ffd166, 6px 6px 0 rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        
        .subtitle {
            color: var(--secondary-color);
            font-size: clamp(1rem, 4vw, 1.5rem);
            margin-bottom: 15px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 30px;
            background-color: var(--light-color);
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }
        
        .timer, .score {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            color: var(--accent-color);
            font-weight: bold;
            margin: 5px 0;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-gap: 15px;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 40px;
        }
        
        .bubble {
            height: var(--bubble-height-desktop);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-medium);
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            padding: 15px;
            box-shadow: var(--bubble-shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            user-select: none;
            color: var(--text-color);
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.8);
            touch-action: manipulation;
        }
        
        .bubble.chinese {
            font-size: clamp(1.1rem, 2.5vw, 1.6rem);
        }
        
        .bubble.vietnamese {
            font-size: clamp(1rem, 2.2vw, 1.5rem);
        }
        
        .pinyin {
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            margin-top: 5px;
            color: #555;
            font-weight: normal;
        }
        
        .bubble:hover, .bubble:active {
            transform: translateY(-5px);
            box-shadow: 
                inset 0 -8px 10px rgba(0, 0, 0, 0.2),
                inset 0 8px 10px rgba(255, 255, 255, 0.7),
                0 15px 25px rgba(0, 0, 0, 0.4);
        }
        
        .bubble.selected {
            transform: scale(1.05);
            box-shadow: 
                inset 0 -8px 10px rgba(0, 0, 0, 0.2),
                inset 0 8px 10px rgba(255, 255, 255, 0.7),
                0 0 0 5px #ffd166,
                0 15px 25px rgba(0, 0, 0, 0.4);
        }
        
        .bubble.matched {
            visibility: hidden;
            opacity: 0;
            transform: scale(0);
            transition: all 0.5s ease;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            width: 100%;
            max-width: 600px;
        }
        
        .success-message {
            display: none;
            flex-direction: column;
            align-items: center;
            background-color: var(--light-color);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            max-width: 600px;
            width: 100%;
        }
        
        .success-message h2 {
            color: var(--secondary-color);
            font-size: clamp(1.5rem, 5vw, 2.8rem);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .success-message p {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            margin-bottom: 25px;
            color: var(--accent-color);
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: clamp(1rem, 3vw, 1.5rem);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            font-weight: bold;
            margin: 10px 5px;
            width: 100%;
            max-width: 300px;
            touch-action: manipulation;
        }
        
        .btn:hover, .btn:active {
            background-color: #ff5252;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            width: 100%;
            max-width: 650px;
        }
        
        .instructions {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            max-width: 1200px;
            width: 100%;
            margin-top: 30px;
            margin-bottom: 30px;
        }
        
        .instructions h3 {
            color: var(--accent-color);
            margin-bottom: 15px;
            font-size: clamp(1.2rem, 3vw, 1.5rem);
        }
        
        .instructions p, .instructions li {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .language-note {
            color: var(--primary-color);
            font-weight: bold;
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            margin-top: 10px;
        }
        
        .footer {
            margin-top: 30px;
            color: #666;
            text-align: center;
            font-size: clamp(0.8rem, 2vw, 1rem);
            padding: 0 10px;
        }
        
        /* 平板设备 */
        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: repeat(4, 1fr);
                grid-gap: 12px;
            }
            
            .bubble {
                height: var(--bubble-height-tablet);
            }
            
            .game-info {
                padding: 12px 15px;
            }
        }
        
        /* 小平板/大手机 */
        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: repeat(3, 1fr);
                grid-gap: 10px;
            }
            
            .bubble {
                height: var(--bubble-height-mobile);
                padding: 10px;
            }
            
            body {
                padding: 15px;
            }
            
            .header {
                padding: 15px 5px;
                margin-bottom: 20px;
            }
            
            .game-info {
                flex-direction: column;
                align-items: center;
                gap: 10px;
                margin-bottom: 20px;
            }
            
            .success-message {
                padding: 20px;
            }
            
            .button-container {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                max-width: 250px;
            }
        }
        
        /* 手机 */
        @media (max-width: 480px) {
            .game-container {
                grid-template-columns: repeat(2, 1fr);
                grid-gap: 8px;
            }
            
            .bubble {
                height: 100px;
                font-size: var(--font-size-small);
                padding: 8px;
            }
            
            body {
                padding: 10px;
            }
            
            .header {
                padding: 10px 5px;
                margin-bottom: 15px;
            }
            
            .game-info {
                padding: 10px;
                margin-bottom: 15px;
            }
            
            .instructions {
                padding: 15px;
                margin-top: 20px;
                margin-bottom: 20px;
            }
            
            .success-message {
                padding: 15px;
            }
            
            .btn {
                padding: 12px 20px;
                margin: 5px 0;
            }
        }
        
        /* 超小手机 */
        @media (max-width: 320px) {
            .game-container {
                grid-template-columns: repeat(2, 1fr);
                grid-gap: 5px;
            }
            
            .bubble {
                height: 90px;
                padding: 5px;
            }
            
            .pinyin {
                font-size: 0.8rem;
            }
        }
        
        /* 横向手机 */
        @media (max-height: 600px) and (orientation: landscape) {
            .header {
                margin-bottom: 15px;
                padding: 10px;
            }
            
            .game-info {
                margin-bottom: 15px;
                padding: 10px 15px;
            }
            
            .game-container {
                margin-bottom: 20px;
            }
            
            .bubble {
                height: 100px;
            }
            
            .instructions {
                margin-top: 15px;
                margin-bottom: 15px;
                padding: 15px;
            }
        }
        
        /* 防止文本选择 */
        .no-select {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* 提高触摸区域 */
        .touch-area {
            min-height: 44px;
            min-width: 44px;
        }
    </style>
</head>
<body class="no-select">
    <div class="header">
        <h1><i class="fas fa-gamepad"></i> 单词消消乐</h1>
        <div class="subtitle">Trò chơi ghép từ Tiếng Trung - Tiếng Việt</div>
    </div>
    
    <div class="game-info">
        <div class="timer">Thời gian: <span id="time">00:00</span></div>
        <div class="score">Đã ghép: <span id="matched-count">0</span> / <span id="total-pairs">9</span> cặp</div>
    </div>
    
    <div class="game-container" id="game-board">
        <!-- Bong bóng sẽ được tạo bằng JavaScript -->
    </div>
    
    <div class="success-message" id="success-message">
        <h2><i class="fas fa-trophy"></i> Chúc mừng bạn đã hoàn thành thử thách!</h2>
        <p>Thời gian hoàn thành: <span id="completion-time">00:00</span></p>
        <div class="button-container">
            <button class="btn" id="next-round"><i class="fas fa-redo"></i> Tiếp tục thử thách</button>
            <button class="btn" id="share-btn"><i class="fas fa-share-alt"></i> Chia sẻ kết quả</button>
        </div>
    </div>
    
    <div class="controls">
        <div class="button-container">
            <button class="btn" id="restart-btn"><i class="fas fa-play-circle"></i> Bắt đầu lại</button>
            <button class="btn" id="hint-btn"><i class="fas fa-lightbulb"></i> Gợi ý (3)</button>
            <button class="btn" id="sound-btn"><i class="fas fa-volume-up"></i> Âm thanh: Bật</button>
        </div>
    </div>
    
    <div class="instructions">
        <h3><i class="fas fa-info-circle"></i> Hướng dẫn trò chơi</h3>
        <p>Trò chơi này giúp học sinh Việt Nam học từ vựng tiếng Trung. Cách chơi như sau:</p>
        <ul>
            <li>Chạm vào một bong bóng bất kỳ, nó sẽ được làm nổi bật và phát âm thanh</li>
            <li>Chạm vào một bong bóng khác, nếu hai bong bóng có từ tiếng Trung và nghĩa tiếng Việt tương ứng, thì chúng sẽ biến mất</li>
            <li>Nếu hai bong bóng không khớp, chúng sẽ trở lại trạng thái ban đầu và bạn cần thử lại</li>
            <li>Sau khi ghép tất cả các cặp từ, trò chơi kết thúc và hiển thị thời gian hoàn thành</li>
        </ul>
        <p class="language-note">Lưu ý: Trên bong bóng có thể là từ tiếng Trung (có kèm phiên âm) hoặc nghĩa tiếng Việt tương ứng</p>
    </div>
    
    <div class="footer">
        <p>© 2023 Giáo dục Hán ngữ Quốc tế - Trò chơi ghép từ cho học sinh Việt Nam</p>
        <p>Thiết kế tương thích với máy tính, máy tính bảng và điện thoại di động</p>
    </div>

    <audio id="pop-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" preload="auto"></audio>
    <audio id="match-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" preload="auto"></audio>
    <audio id="win-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>

    <script>
        // 单词列表 - 中文、拼音和越南语翻译对应
        const wordPairs = [
            { chinese: "请问", pinyin: "qǐng wèn", vietnamese: "Xin hỏi" },
            { chinese: "今天", pinyin: "jīn tiān", vietnamese: "Hôm nay" },
            { chinese: "号", pinyin: "hào", vietnamese: "Ngày (trong tháng)" },
            { chinese: "月", pinyin: "yuè", vietnamese: "Tháng" },
            { chinese: "星期", pinyin: "xīng qī", vietnamese: "Thứ (trong tuần)" },
            { chinese: "昨天", pinyin: "zuó tiān", vietnamese: "Hôm qua" },
            { chinese: "明天", pinyin: "míng tiān", vietnamese: "Ngày mai" },
            { chinese: "去", pinyin: "qù", vietnamese: "Đi" },
            { chinese: "学校", pinyin: "xué xiào", vietnamese: "Trường học" },
            { chinese: "看", pinyin: "kàn", vietnamese: "Xem" },
            { chinese: "好看", pinyin: "hǎo kàn", vietnamese: "Đẹp" },
            { chinese: "书", pinyin: "shū", vietnamese: "Sách" },
            { chinese: "菜", pinyin: "cài", vietnamese: "Món ăn" },
            { chinese: "中国菜", pinyin: "zhōng guó cài", vietnamese: "Món Trung Quốc" },
            { chinese: "会", pinyin: "huì", vietnamese: "Có thể" },
            { chinese: "不会", pinyin: "bú huì", vietnamese: "Không thể" },
            { chinese: "汉字", pinyin: "hàn zì", vietnamese: "Chữ Hán" },
            { chinese: "写字", pinyin: "xiě zì", vietnamese: "Viết chữ" },
            { chinese: "好吃", pinyin: "hǎo chī", vietnamese: "Ngon" },
            { chinese: "怎么", pinyin: "zěn me", vietnamese: "Như thế nào" }
        ];

        // 游戏状态变量
        let gameState = {
            selectedBubbles: [],
            matchedPairs: 0,
            totalPairs: 0,
            startTime: null,
            timerInterval: null,
            currentWords: [],
            gameActive: true,
            hintsRemaining: 3,
            soundEnabled: true,
            lastTapTime: 0
        };

        // DOM元素
        const gameBoard = document.getElementById('game-board');
        const timerElement = document.getElementById('time');
        const matchedCountElement = document.getElementById('matched-count');
        const totalPairsElement = document.getElementById('total-pairs');
        const successMessage = document.getElementById('success-message');
        const completionTimeElement = document.getElementById('completion-time');
        const nextRoundButton = document.getElementById('next-round');
        const restartButton = document.getElementById('restart-btn');
        const hintButton = document.getElementById('hint-btn');
        const soundButton = document.getElementById('sound-btn');
        const shareButton = document.getElementById('share-btn');
        
        // 音效
        const popSound = document.getElementById('pop-sound');
        const matchSound = document.getElementById('match-sound');
        const winSound = document.getElementById('win-sound');

        // 初始化游戏
        function initGame() {
            // 重置游戏状态
            gameState.selectedBubbles = [];
            gameState.matchedPairs = 0;
            gameState.gameActive = true;
            gameState.startTime = new Date();
            gameState.hintsRemaining = 3;
            
            // 清空游戏板
            gameBoard.innerHTML = '';
            
            // 隐藏成功消息
            successMessage.style.display = 'none';
            
            // 从单词列表中随机选择9对单词
            gameState.currentWords = getRandomWordPairs(9);
            gameState.totalPairs = gameState.currentWords.length;
            
            // 更新显示
            totalPairsElement.textContent = gameState.totalPairs;
            matchedCountElement.textContent = gameState.matchedPairs;
            hintButton.innerHTML = `<i class="fas fa-lightbulb"></i> Gợi ý (${gameState.hintsRemaining})`;
            
            // 创建单词数组（中文和越南语混合）
            let words = [];
            gameState.currentWords.forEach(pair => {
                words.push({ 
                    text: pair.chinese, 
                    pinyin: pair.pinyin,
                    type: 'chinese', 
                    pairId: pair.id 
                });
                words.push({ 
                    text: pair.vietnamese, 
                    pinyin: '',
                    type: 'vietnamese', 
                    pairId: pair.id 
                });
            });
            
            // 随机排序单词
            words = shuffleArray(words);
            
            // 创建泡泡
            words.forEach((word, index) => {
                const bubble = document.createElement('div');
                bubble.className = `bubble ${word.type} touch-area`;
                bubble.dataset.index = index;
                bubble.dataset.pairId = word.pairId;
                bubble.dataset.type = word.type;
                
                // 根据类型设置内容
                if (word.type === 'chinese') {
                    bubble.innerHTML = `
                        <div>${word.text}</div>
                        <div class="pinyin">${word.pinyin}</div>
                    `;
                } else {
                    bubble.textContent = word.text;
                }
                
                // 随机颜色生成
                const hue = Math.floor(Math.random() * 360);
                const saturation = 70 + Math.floor(Math.random() * 20);
                const lightness = 60 + Math.floor(Math.random() * 15);
                
                bubble.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                
                // 添加点击事件 - 支持触摸和点击
                bubble.addEventListener('click', handleBubbleInteraction);
                bubble.addEventListener('touchstart', handleBubbleInteraction, { passive: true });
                
                gameBoard.appendChild(bubble);
            });
            
            // 启动计时器
            startTimer();
            
            // 更新按钮文本
            updateSoundButtonText();
        }

        // 处理泡泡交互（防双击）
        function handleBubbleInteraction(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const currentTime = new Date().getTime();
            const tapLength = currentTime - gameState.lastTapTime;
            
            // 防止双击/快速点击
            if (tapLength < 500) return;
            
            gameState.lastTapTime = currentTime;
            
            const bubble = event.currentTarget;
            
            // 如果是触摸事件，确保触发点击效果
            if (event.type === 'touchstart') {
                bubble.click();
                return;
            }
            
            if (!gameState.gameActive) return;
            
            // 如果泡泡已经匹配或已经选中，则忽略点击
            if (bubble.classList.contains('matched') || bubble.classList.contains('selected')) {
                return;
            }
            
            // 播放点击音效
            playSound(popSound);
            
            // 如果已经选择了两个泡泡，先重置
            if (gameState.selectedBubbles.length === 2) {
                resetSelectedBubbles();
            }
            
            // 添加选中样式
            bubble.classList.add('selected');
            gameState.selectedBubbles.push(bubble);
            
            // 如果选择了两个泡泡，检查是否匹配
            if (gameState.selectedBubbles.length === 2) {
                const bubble1 = gameState.selectedBubbles[0];
                const bubble2 = gameState.selectedBubbles[1];
                
                // 检查是否匹配（同一对单词，且一个中文一个越南语）
                if (bubble1.dataset.pairId === bubble2.dataset.pairId && 
                    bubble1.dataset.type !== bubble2.dataset.type) {
                    
                    // 匹配成功
                    setTimeout(() => {
                        bubble1.classList.add('matched');
                        bubble2.classList.add('matched');
                        
                        // 播放匹配音效
                        playSound(matchSound);
                        
                        // 更新匹配计数
                        gameState.matchedPairs++;
                        matchedCountElement.textContent = gameState.matchedPairs;
                        
                        // 清空选中泡泡
                        gameState.selectedBubbles = [];
                        
                        // 检查游戏是否结束
                        if (gameState.matchedPairs === gameState.totalPairs) {
                            endGame();
                        }
                    }, 500);
                } else {
                    // 不匹配，稍后重置
                    setTimeout(() => {
                        resetSelectedBubbles();
                    }, 1000);
                }
            }
        }

        // 获取随机单词对
        function getRandomWordPairs(count) {
            // 复制单词列表
            const shuffled = [...wordPairs].sort(() => 0.5 - Math.random());
            // 取前count个单词对，并为每个添加唯一ID
            return shuffled.slice(0, count).map((pair, index) => ({
                ...pair,
                id: index
            }));
        }

        // 数组洗牌函数
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // 重置选中的泡泡
        function resetSelectedBubbles() {
            gameState.selectedBubbles.forEach(bubble => {
                bubble.classList.remove('selected');
            });
            gameState.selectedBubbles = [];
        }

        // 开始计时器
        function startTimer() {
            clearInterval(gameState.timerInterval);
            
            gameState.timerInterval = setInterval(() => {
                const currentTime = new Date();
                const elapsedSeconds = Math.floor((currentTime - gameState.startTime) / 1000);
                const minutes = Math.floor(elapsedSeconds / 60);
                const seconds = elapsedSeconds % 60;
                
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // 结束游戏
        function endGame() {
            gameState.gameActive = false;
            clearInterval(gameState.timerInterval);
            
            // 播放胜利音效
            playSound(winSound);
            
            // 显示完成时间
            const currentTime = new Date();
            const elapsedSeconds = Math.floor((currentTime - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsedSeconds / 60);
            const seconds = elapsedSeconds % 60;
            completionTimeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // 显示成功消息
            setTimeout(() => {
                successMessage.style.display = 'flex';
                // 滚动到成功消息
                successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 1000);
        }

        // 播放音效函数
        function playSound(sound) {
            if (!gameState.soundEnabled) return;
            
            sound.currentTime = 0;
            sound.play().catch(e => {
                console.log("Không thể phát âm thanh:", e);
                // 在移动设备上，用户可能需要先交互才能播放声音
                // 这里我们静默失败
            });
        }
        
        // 提示功能
        function giveHint() {
            if (!gameState.gameActive || gameState.hintsRemaining <= 0) return;
            
            // 找到未匹配的泡泡
            const unmatchedBubbles = Array.from(document.querySelectorAll('.bubble:not(.matched)'));
            
            if (unmatchedBubbles.length < 2) return;
            
            // 找到一对未匹配的对应泡泡
            const pairsMap = {};
            let matchFound = false;
            let bubble1, bubble2;
            
            for (const bubble of unmatchedBubbles) {
                const pairId = bubble.dataset.pairId;
                const type = bubble.dataset.type;
                
                if (!pairsMap[pairId]) {
                    pairsMap[pairId] = {};
                }
                
                pairsMap[pairId][type] = bubble;
                
                // 检查是否找到一对
                if (pairsMap[pairId].chinese && pairsMap[pairId].vietnamese) {
                    bubble1 = pairsMap[pairId].chinese;
                    bubble2 = pairsMap[pairId].vietnamese;
                    matchFound = true;
                    break;
                }
            }
            
            if (matchFound && bubble1 && bubble2) {
                // 高亮显示配对泡泡
                bubble1.classList.add('selected');
                bubble2.classList.add('selected');
                
                // 减少提示次数
                gameState.hintsRemaining--;
                hintButton.innerHTML = `<i class="fas fa-lightbulb"></i> Gợi ý (${gameState.hintsRemaining})`;
                
                // 2秒后取消高亮
                setTimeout(() => {
                    bubble1.classList.remove('selected');
                    bubble2.classList.remove('selected');
                }, 2000);
            }
        }
        
        // 切换声音
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            updateSoundButtonText();
        }
        
        // 更新声音按钮文本
        function updateSoundButtonText() {
            soundButton.innerHTML = `<i class="fas fa-volume-${gameState.soundEnabled ? 'up' : 'mute'}"></i> Âm thanh: ${gameState.soundEnabled ? 'Bật' : 'Tắt'}`;
        }
        
        // 分享结果
        function shareResult() {
            const time = completionTimeElement.textContent;
            const matched = matchedCountElement.textContent.split('/')[0].trim();
            const total = totalPairsElement.textContent;
            
            const text = `Tôi đã hoàn thành trò chơi Ghép từ Tiếng Trung với ${matched}/${total} cặp từ trong thời gian ${time}! Hãy thử sức bạn nhé!`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Kết quả Ghép từ Tiếng Trung',
                    text: text,
                    url: window.location.href
                }).catch(err => {
                    console.log('Chia sẻ thất bại:', err);
                    copyToClipboard(text);
                });
            } else {
                copyToClipboard(text);
            }
        }
        
        // 复制到剪贴板
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            alert('Đã sao chép kết quả vào clipboard!');
        }
        
        // 事件监听器
        nextRoundButton.addEventListener('click', initGame);
        restartButton.addEventListener('click', initGame);
        hintButton.addEventListener('click', giveHint);
        soundButton.addEventListener('click', toggleSound);
        shareButton.addEventListener('click', shareResult);
        
        // 阻止上下文菜单（在移动设备上长按）
        document.addEventListener('contextmenu', function(e) {
            if (e.target.classList.contains('bubble')) {
                e.preventDefault();
            }
        });

        // 页面加载时初始化游戏
        document.addEventListener('DOMContentLoaded', initGame);
        
        // 防止窗口滚动导致游戏体验不好
        window.addEventListener('touchmove', function(e) {
            if (e.target.classList.contains('bubble')) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
