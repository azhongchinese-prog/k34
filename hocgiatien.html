<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mua s·∫Øm - Th·∫ßy Trung bi√™n so·∫°n</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #4e54c8, #8f94fb);
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .main-content {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .vocabulary-sidebar {
            width: 320px;
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }
        
        .vocabulary-header {
            font-size: 1.4rem;
            color: #4e54c8;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .vocabulary-table {
            flex: 1;
            overflow-y: auto;
            max-height: 500px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background-color: #f0f4ff;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #4e54c8;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        tr:hover {
            background-color: #f9f9ff;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #e0e0e0;
            z-index: 1;
        }
        
        .step {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #e0e0e0;
            color: #888;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background-color: #4e54c8;
            color: white;
            transform: scale(1.1);
        }
        
        .step.completed {
            background-color: #8f94fb;
            color: white;
        }
        
        .step-label {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.85rem;
            color: #666;
        }
        
        .step.active .step-label {
            color: #4e54c8;
            font-weight: 600;
        }
        
        .dialogue-container {
            background-color: #f9f9ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            min-height: 180px;
        }
        
        .dialogue {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 8px;
            position: relative;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .customer {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
            margin-right: 40px;
        }
        
        .salesperson {
            background-color: #f6ffed;
            border-left: 4px solid #52c41a;
            margin-left: 40px;
            text-align: right;
        }
        
        .speaker {
            font-weight: bold;
            margin-bottom: 5px;
            color: #4e54c8;
        }
        
        .pinyin {
            color: #666;
            font-style: italic;
            margin: 5px 0;
            font-size: 0.95rem;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .option-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background-color: white;
        }
        
        .option-card:hover {
            border-color: #8f94fb;
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(142, 148, 251, 0.2);
        }
        
        .option-card.selected {
            border-color: #4e54c8;
            background-color: #f0f4ff;
        }
        
        .emoji {
            font-size: 2.8rem;
            margin-bottom: 10px;
        }
        
        .item-name {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .item-price {
            font-size: 1.2rem;
            color: #ff6b6b;
            font-weight: 600;
        }
        
        .selection-summary {
            background-color: #f9f9ff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            min-height: 120px;
        }
        
        .summary-title {
            font-size: 1.2rem;
            color: #4e54c8;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .summary-content {
            font-size: 1.1rem;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }
        
        button {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #nextBtn, #checkoutBtn {
            background-color: #4e54c8;
            color: white;
        }
        
        #nextBtn:hover, #checkoutBtn:hover {
            background-color: #3a3f9e;
        }
        
        #nextBtn:disabled, #checkoutBtn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        #restartBtn {
            background-color: #f0f0f0;
            color: #666;
        }
        
        #restartBtn:hover {
            background-color: #e0e0e0;
        }
        
        #continueShoppingBtn {
            background-color: #8f94fb;
            color: white;
            margin-left: 10px;
        }
        
        #continueShoppingBtn:hover {
            background-color: #6b71e8;
        }
        
        .completion-screen {
            text-align: center;
            padding: 30px;
            display: none;
        }
        
        .completion-icon {
            font-size: 4rem;
            color: #52c41a;
            margin-bottom: 20px;
        }
        
        .completion-title {
            font-size: 1.8rem;
            color: #4e54c8;
            margin-bottom: 15px;
        }
        
        .completion-message {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-align: left;
            line-height: 1.8;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #4e54c8;
            font-size: 1.3rem;
            font-weight: 600;
            color: #4e54c8;
        }
        
        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
            }
            
            .vocabulary-sidebar {
                width: 100%;
            }
            
            .vocabulary-table {
                max-height: 300px;
            }
        }
        
        @media (max-width: 600px) {
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .step-label {
                display: none;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .dialogue-container {
                padding: 15px;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            
            #continueShoppingBtn {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üõçÔ∏è Luy·ªán t·∫≠p ƒë·ªëi tho·∫°i mua h√†ng</h1>
        <p class="subtitle">Th·∫ßy Trung bi√™n so·∫°n</p>
    </header>
    
    <div class="container">
        <div class="main-content">
            <div class="step-indicator">
                <div class="step active" id="step1">
                    <span>1</span>
                    <div class="step-label">ÈÄâÊã©ÂïÜÂìÅ</div>
                </div>
                <div class="step" id="step2">
                    <span>2</span>
                    <div class="step-label">ÈÄâÊã©Êï∞Èáè</div>
                </div>
                <div class="step" id="step3">
                    <span>3</span>
                    <div class="step-label">ÁªßÁª≠Ë¥≠Áâ©</div>
                </div>
                <div class="step" id="step4">
                    <span>4</span>
                    <div class="step-label">ÁªìË¥¶</div>
                </div>
            </div>
            
            <div class="dialogue-container" id="dialogueContainer">
                <!-- ÂØπËØùÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <div class="options-container" id="optionsContainer">
                <!-- ÈÄâÈ°πÂç°ÁâáÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <div class="selection-summary">
                <div class="summary-title">üìã Ë¥≠Áâ©ËΩ¶ÂÜÖÂÆπ</div>
                <div class="summary-content" id="selectionSummary">Ë¥≠Áâ©ËΩ¶ÊòØÁ©∫ÁöÑ</div>
            </div>
            
            <div class="controls">
                <button id="restartBtn">ÈáçÊñ∞ÂºÄÂßã</button>
                <div>
                    <button id="continueShoppingBtn" style="display: none;">ÁªßÁª≠Ë¥≠Áâ©</button>
                    <button id="nextBtn" style="display: none;">‰∏ã‰∏ÄÊ≠•</button>
                    <button id="checkoutBtn" style="display: none;">ÁªìË¥¶</button>
                </div>
            </div>
            
            <div class="completion-screen" id="completionScreen">
                <div class="completion-icon">‚úÖ</div>
                <h2 class="completion-title">Ë¥≠Áâ©ÂÆåÊàêÔºÅ</h2>
                <div class="completion-message" id="completionMessage"></div>
                <button id="newOrderBtn">ÂºÄÂßãÊñ∞ÁöÑËÆ¢Âçï</button>
            </div>
        </div>
        
        <div class="vocabulary-sidebar">
            <div class="vocabulary-header">üìö HSK1 ËØçÊ±áË°® (T·ª´ v·ª±ng HSK1)</div>
            <div class="vocabulary-table">
                <table>
                    <thead>
                        <tr>
                            <th>Ê±âÂ≠ó</th>
                            <th>ÊãºÈü≥</th>
                            <th>Ë∂äÂçóËØ≠Èáä‰πâ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>‰Ω†</td>
                            <td>n«ê</td>
                            <td>b·∫°n, anh, ch·ªã, ...</td>
                        </tr>
                        <tr>
                            <td>Â•Ω</td>
                            <td>h«éo</td>
                            <td>t·ªët, ƒë∆∞·ª£c, kh·ªèe</td>
                        </tr>
                        <tr>
                            <td>Êàë</td>
                            <td>w«í</td>
                            <td>t√¥i, t·ªõ, ta</td>
                        </tr>
                        <tr>
                            <td>‰π∞</td>
                            <td>m«éi</td>
                            <td>mua</td>
                        </tr>
                        <tr>
                            <td>Èí±</td>
                            <td>qi√°n</td>
                            <td>ti·ªÅn</td>
                        </tr>
                        <tr>
                            <td>Ëøô‰∏™</td>
                            <td>zh√®ge</td>
                            <td>c√°i n√†y</td>
                        </tr>
                        <tr>
                            <td>ÈÇ£‰∏™</td>
                            <td>n√†g√®</td>
                            <td>c√°i kia</td>
                        </tr>
                        <tr>
                            <td>Â§öÂ∞ë</td>
                            <td>du≈çsh«éo</td>
                            <td>bao nhi√™u</td>
                        </tr>
                        <tr>
                            <td>Âùó</td>
                            <td>ku√†i</td>
                            <td>ƒë·ªìng (ti·ªÅn t·ªá)</td>
                        </tr>
                        <tr>
                            <td>Ë∞¢Ë∞¢</td>
                            <td>xi√®xie</td>
                            <td>c·∫£m ∆°n</td>
                        </tr>
                        <tr>
                            <td>ËØ∑</td>
                            <td>q«êng</td>
                            <td>xin m·ªùi, m·ªùi</td>
                        </tr>
                        <tr>
                            <td>Áúã</td>
                            <td>k√†n</td>
                            <td>nh√¨n, xem</td>
                        </tr>
                        <tr>
                            <td>Ë¶Å</td>
                            <td>y√†o</td>
                            <td>mu·ªën, c·∫ßn</td>
                        </tr>
                        <tr>
                            <td>Âæà</td>
                            <td>hƒõn</td>
                            <td>r·∫•t</td>
                        </tr>
                        <tr>
                            <td>‰πü</td>
                            <td>yƒõ</td>
                            <td>c≈©ng</td>
                        </tr>
                        <tr>
                            <td>‰∏ç</td>
                            <td>b√π</td>
                            <td>kh√¥ng</td>
                        </tr>
                        <tr>
                            <td>‰∏Ä</td>
                            <td>yƒ´</td>
                            <td>m·ªôt, 1</td>
                        </tr>
                        <tr>
                            <td>‰∫å</td>
                            <td>√®r</td>
                            <td>hai, 2</td>
                        </tr>
                        <tr>
                            <td>‰∏â</td>
                            <td>sƒÅn</td>
                            <td>ba, 3</td>
                        </tr>
                        <tr>
                            <td>Âõõ</td>
                            <td>s√¨</td>
                            <td>b·ªën, 4</td>
                        </tr>
                        <tr>
                            <td>‰∫î</td>
                            <td>w«î</td>
                            <td>nƒÉm, 5</td>
                        </tr>
                        <tr>
                            <td>Âíå</td>
                            <td>h√©</td>
                            <td>v√†</td>
                        </tr>
                        <tr>
                            <td>Ëøò</td>
                            <td>h√°i</td>
                            <td>c√≤n, v·∫´n</td>
                        </tr>
                        <tr>
                            <td>ÂÖ±</td>
                            <td>g√≤ng</td>
                            <td>t·ªïng c·ªông</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // ÂïÜÂìÅÊï∞ÊçÆ - ÂåÖÂê´ÈáèËØç
        const products = [
            { emoji: "üíç", name: "ÊâãÈïØ", pinyin: "sh«íuzhu√≥", price: 100, measureWord: "‰∏™" },
            { emoji: "üß§", name: "ÊâãÂ•ó", pinyin: "sh«íut√†o", price: 20, measureWord: "Âèå" },
            { emoji: "‚åö", name: "ÊâãË°®", pinyin: "sh«íubi«éo", price: 80, measureWord: "Âùó" },
            { emoji: "üìö", name: "‰π¶", pinyin: "sh≈´", price: 35, measureWord: "Êú¨" },
            { emoji: "ü•õ", name: "ÊùØÂ≠ê", pinyin: "bƒìizi", price: 28, measureWord: "‰∏™" },
            { emoji: "ü•£", name: "Á¢ó", pinyin: "w«én", price: 15, measureWord: "‰∏™" },
            { emoji: "üì±", name: "ÊâãÊú∫", pinyin: "sh«íujƒ´", price: 1500, measureWord: "ÈÉ®" }
        ];
        
        // Ê∏∏ÊàèÁä∂ÊÄÅ
        let currentStep = 1;
        let selectedProduct = null;
        let selectedQuantity = 1;
        let shoppingCart = []; // Ë¥≠Áâ©ËΩ¶Êï∞ÁªÑ
        let isFirstTime = true; // ÊòØÂê¶ÊòØÁ¨¨‰∏ÄÊ¨°ÈÄâÊã©ÂïÜÂìÅ
        
        // DOMÂÖÉÁ¥†
        const steps = document.querySelectorAll('.step');
        const dialogueContainer = document.getElementById('dialogueContainer');
        const optionsContainer = document.getElementById('optionsContainer');
        const selectionSummary = document.getElementById('selectionSummary');
        const nextBtn = document.getElementById('nextBtn');
        const restartBtn = document.getElementById('restartBtn');
        const continueShoppingBtn = document.getElementById('continueShoppingBtn');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const completionScreen = document.getElementById('completionScreen');
        const completionMessage = document.getElementById('completionMessage');
        const newOrderBtn = document.getElementById('newOrderBtn');
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            currentStep = 1;
            selectedProduct = null;
            selectedQuantity = 1;
            shoppingCart = [];
            isFirstTime = true;
            
            // ÈáçÁΩÆÊ≠•È™§ÊåáÁ§∫Âô®
            steps.forEach(step => {
                step.classList.remove('active', 'completed');
            });
            steps[0].classList.add('active');
            
            // ÈöêËóèÂÆåÊàêÂ±èÂπï
            completionScreen.style.display = 'none';
            
            // ÊòæÁ§∫‰∏ªÊ∏∏ÊàèÁïåÈù¢
            document.querySelector('.dialogue-container').style.display = 'block';
            document.querySelector('.options-container').style.display = 'grid';
            document.querySelector('.selection-summary').style.display = 'block';
            document.querySelector('.controls').style.display = 'flex';
            
            // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
            nextBtn.style.display = 'none';
            continueShoppingBtn.style.display = 'none';
            checkoutBtn.style.display = 'none';
            
            // Êõ¥Êñ∞ÁïåÈù¢
            updateStep();
            updateSelectionSummary();
        }
        
        // Êõ¥Êñ∞ÂΩìÂâçÊ≠•È™§
        function updateStep() {
            // Êõ¥Êñ∞Ê≠•È™§ÊåáÁ§∫Âô®
            steps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });
            
            // Ê∏ÖÁ©∫ÂØπËØùÂíåÈÄâÈ°πÂÆπÂô®
            dialogueContainer.innerHTML = '';
            optionsContainer.innerHTML = '';
            
            // Ê†πÊçÆÂΩìÂâçÊ≠•È™§ÊòæÁ§∫ÂÜÖÂÆπ
            switch(currentStep) {
                case 1:
                    showStep1();
                    break;
                case 2:
                    showStep2();
                    break;
                case 3:
                    showStep3();
                    break;
                case 4:
                    showStep4();
                    break;
            }
        }
        
        // Ê≠•È™§1ÔºöÈóÆÂÄôÂπ∂ÈÄâÊã©ÂïÜÂìÅ
        function showStep1() {
            if (isFirstTime) {
                // Ê∑ªÂä†ÂàùÂßãÈóÆÂÄôÂØπËØù
                addDialogue("salesperson", "ÂîÆË¥ßÂëò", "‰Ω†Â•ΩÔºÅÊ¨¢ËøéÂÖâ‰∏¥ÔºÅ‰Ω†ÊÉ≥‰π∞‰ªÄ‰πàÔºü", "N«ê h«éo! HuƒÅny√≠ng guƒÅngl√≠n! N«ê xi«éng m«éi sh√©nme?");
            } else {
                // ÁªßÁª≠Ë¥≠Áâ©Êó∂ÁöÑÂØπËØù
                addDialogue("salesperson", "ÂîÆË¥ßÂëò", "ÊÇ®ËøòË¶Å‰π∞‰ªÄ‰πàÔºü", "N√≠n h√°i y√†o m«éi sh√©nme?");
            }
            
            // Ê∑ªÂä†ÂïÜÂìÅÈÄâÈ°π
            let availableProducts = [];
            
            if (isFirstTime) {
                // Á¨¨‰∏ÄÊ¨°ÈÄâÊã©Êó∂ÔºåÊòæÁ§∫ÊâÄÊúâÂïÜÂìÅ
                availableProducts = getRandomProducts(5, []);
            } else {
                // ÁªßÁª≠Ë¥≠Áâ©Êó∂ÔºåÂè™ÊòæÁ§∫‰∏çÂú®Ë¥≠Áâ©ËΩ¶‰∏≠ÁöÑÂïÜÂìÅ
                availableProducts = products.filter(product => 
                    !shoppingCart.some(item => item.product.name === product.name)
                );
            }
            
            // Â¶ÇÊûúÊ≤°ÊúâÂèØË¥≠‰π∞ÁöÑÂïÜÂìÅ‰∫ÜÔºåÁõ¥Êé•ËøõÂÖ•ÁªìË¥¶
            if (availableProducts.length === 0) {
                addDialogue("customer", "È°æÂÆ¢", "‰∏çË¶Å‰∫ÜÔºåË∞¢Ë∞¢„ÄÇ", "B√∫ y√†o le, xi√®xie.");
                setTimeout(() => {
                    goToCheckout();
                }, 1000);
                return;
            }
            
            // Ê∑ªÂä†ÁªìË¥¶ÈÄâÈ°πÔºàÂè™Âú®ÁªßÁª≠Ë¥≠Áâ©Êó∂ÊòæÁ§∫Ôºâ
            if (!isFirstTime) {
                const checkoutOption = document.createElement('div');
                checkoutOption.className = 'option-card';
                checkoutOption.innerHTML = `
                    <div class="emoji">üí∞</div>
                    <div class="item-name">ÁªìË¥¶</div>
                    <div class="pinyin">ji√©zh√†ng</div>
                `;
                
                checkoutOption.addEventListener('click', () => {
                    // ÊòæÁ§∫È°æÂÆ¢ÁöÑÂØπËØù
                    addDialogue("customer", "È°æÂÆ¢", "‰∏çË¶Å‰∫ÜÔºåÁªìË¥¶Âêß„ÄÇ", "B√∫ y√†o le, ji√©zh√†ng ba.");
                    
                    // Ë∑≥ËΩ¨Âà∞ÁªìË¥¶Ê≠•È™§
                    setTimeout(() => {
                        goToCheckout();
                    }, 1000);
                });
                
                optionsContainer.appendChild(checkoutOption);
            }
            
            // Ê∑ªÂä†ÂïÜÂìÅÈÄâÈ°π
            availableProducts.forEach(product => {
                createOptionCard(product, () => {
                    selectedProduct = product;
                    
                    // ÊòæÁ§∫È°æÂÆ¢ÁöÑÂõûÂ∫îÂØπËØù
                    addDialogue("customer", "È°æÂÆ¢", `ÊàëÊÉ≥ÁúãÁúã${product.name}„ÄÇ`, `W«í xi«éng k√†nkan ${product.pinyin}.`);
                    
                    // ÁÑ∂ÂêéÊòæÁ§∫ÂîÆË¥ßÂëòÂõûÂ∫î
                    setTimeout(() => {
                        addDialogue("salesperson", "ÂîÆË¥ßÂëò", `Ëøô‰∏™${product.name}${product.price}ÂùóÈí±„ÄÇ`, `Zh√®ge ${product.name} ${product.price} ku√†i qi√°n.`);
                        
                        // Ëá™Âä®ËøõÂÖ•Ê≠•È™§2ÔºàÈÄâÊã©Êï∞ÈáèÔºâ
                        setTimeout(() => {
                            currentStep = 2;
                            updateStep();
                        }, 1000);
                    }, 1000);
                });
            });
        }
        
        // Ê≠•È™§2ÔºöÈÄâÊã©Êï∞Èáè
        function showStep2() {
            // ÊòæÁ§∫Êï∞ÈáèÈÄâÊã©ÈÄâÈ°π
            const quantities = [1, 2, 3, 4, 5];
            quantities.forEach(quantity => {
                const option = document.createElement('div');
                option.className = 'option-card';
                const totalPrice = selectedProduct.price * quantity;
                option.innerHTML = `
                    <div class="emoji">${quantity}Ô∏è‚É£</div>
                    <div class="item-name">${quantity}${selectedProduct.measureWord}</div>
                    <div class="pinyin">${getPinyinForNumber(quantity)} ${selectedProduct.measureWord}</div>
                    <div class="item-price">${totalPrice}Âùó</div>
                `;
                
                option.addEventListener('click', () => {
                    // ÁßªÈô§‰πãÂâçÁöÑÈÄâÊã©
                    document.querySelectorAll('.option-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    
                    // Ê†áËÆ∞ÂΩìÂâçÈÄâÊã©
                    option.classList.add('selected');
                    selectedQuantity = quantity;
                    
                    // ÊòæÁ§∫È°æÂÆ¢ÁöÑÂØπËØù
                    addDialogue("customer", "È°æÂÆ¢", `Êàë‰π∞${getChineseNumber(quantity)}${selectedProduct.measureWord}„ÄÇ`, `W«í m«éi ${getPinyinForNumber(quantity)} ${selectedProduct.measureWord}.`);
                    
                    // Â∞ÜÂïÜÂìÅÊ∑ªÂä†Âà∞Ë¥≠Áâ©ËΩ¶
                    const cartItem = {
                        product: selectedProduct,
                        quantity: selectedQuantity,
                        totalPrice: selectedProduct.price * selectedQuantity
                    };
                    
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®‰∫éË¥≠Áâ©ËΩ¶‰∏≠
                    const existingIndex = shoppingCart.findIndex(item => item.product.name === selectedProduct.name);
                    if (existingIndex >= 0) {
                        shoppingCart[existingIndex] = cartItem;
                    } else {
                        shoppingCart.push(cartItem);
                    }
                    
                    // ÁÑ∂ÂêéÊòæÁ§∫ÂîÆË¥ßÂëòÁ°ÆËÆ§
                    setTimeout(() => {
                        addDialogue("salesperson", "ÂîÆË¥ßÂëò", `Â•ΩÁöÑÔºå${quantity}${selectedProduct.measureWord}${selectedProduct.name}Ôºå‰∏ÄÂÖ±${cartItem.totalPrice}ÂùóÈí±„ÄÇ`, `H«éo de, ${quantity} ${selectedProduct.measureWord} ${selectedProduct.name}, yƒ´g√≤ng ${cartItem.totalPrice} ku√†i qi√°n.`);
                        
                        // Êõ¥Êñ∞Ë¥≠Áâ©ËΩ¶ÊëòË¶Å
                        updateSelectionSummary();
                        
                        // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°Ë¥≠‰π∞ÔºåÊòæÁ§∫ÁªßÁª≠Ë¥≠Áâ©ÊåâÈíÆ
                        if (isFirstTime) {
                            setTimeout(() => {
                                isFirstTime = false;
                                currentStep = 3;
                                updateStep();
                            }, 1000);
                        } else {
                            // Â¶ÇÊûú‰∏çÊòØÁ¨¨‰∏ÄÊ¨°ÔºåÁõ¥Êé•ÂõûÂà∞Ê≠•È™§1ÁªßÁª≠Ë¥≠Áâ©
                            setTimeout(() => {
                                currentStep = 1;
                                updateStep();
                            }, 1000);
                        }
                    }, 1000);
                });
                
                optionsContainer.appendChild(option);
            });
        }
        
        // Ê≠•È™§3ÔºöÁªßÁª≠Ë¥≠Áâ©ÈÄâÈ°π
        function showStep3() {
            // Êõ¥Êñ∞ÊåâÈíÆÊòæÁ§∫
            continueShoppingBtn.style.display = 'inline-block';
            checkoutBtn.style.display = 'inline-block';
            
            // Ê∑ªÂä†ÂîÆË¥ßÂëòËØ¢ÈóÆ
            addDialogue("salesperson", "ÂîÆË¥ßÂëò", "ÊÇ®ËøòË¶Å‰π∞‰ªÄ‰πàÔºü", "N√≠n h√°i y√†o m«éi sh√©nme?");
            
            // ÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
            const infoCard = document.createElement('div');
            infoCard.className = 'option-card';
            infoCard.style.cursor = 'default';
            infoCard.style.backgroundColor = '#f9f9ff';
            infoCard.innerHTML = `
                <div class="emoji">üõí</div>
                <div class="item-name">ÊÇ®Â∑≤ÈÄâÊã© ${shoppingCart.length} ÁßçÂïÜÂìÅ</div>
                <div class="pinyin">ËØ∑ÈÄâÊã©ÁªßÁª≠Ë¥≠Áâ©ÊàñÁªìË¥¶</div>
            `;
            optionsContainer.appendChild(infoCard);
            
            // ÊòæÁ§∫ÁªßÁª≠Ë¥≠Áâ©ÈÄâÈ°π
            const continueOption = document.createElement('div');
            continueOption.className = 'option-card';
            continueOption.innerHTML = `
                <div class="emoji">üõçÔ∏è</div>
                <div class="item-name">ÁªßÁª≠Ë¥≠Áâ©</div>
                <div class="pinyin">j√¨x√π g√≤uw√π</div>
            `;
            
            continueOption.addEventListener('click', () => {
                // ÊòæÁ§∫È°æÂÆ¢ÁöÑÂØπËØù
                addDialogue("customer", "È°æÂÆ¢", "ÊàëËøòÊÉ≥ÁúãÁúãÂà´ÁöÑ„ÄÇ", "W«í h√°i xi«éng k√†nkan bi√© de.");
                
                // ËøõÂÖ•Ê≠•È™§1ÁªßÁª≠Ë¥≠Áâ©
                setTimeout(() => {
                    currentStep = 1;
                    updateStep();
                }, 1000);
            });
            
            optionsContainer.appendChild(continueOption);
            
            // ÊòæÁ§∫ÁªìË¥¶ÈÄâÈ°π
            const checkoutOption = document.createElement('div');
            checkoutOption.className = 'option-card';
            checkoutOption.innerHTML = `
                <div class="emoji">üí∞</div>
                <div class="item-name">ÁªìË¥¶</div>
                <div class="pinyin">ji√©zh√†ng</div>
            `;
            
            checkoutOption.addEventListener('click', () => {
                // ÊòæÁ§∫È°æÂÆ¢ÁöÑÂØπËØù
                addDialogue("customer", "È°æÂÆ¢", "‰∏çË¶Å‰∫ÜÔºåÁªìË¥¶Âêß„ÄÇ", "B√∫ y√†o le, ji√©zh√†ng ba.");
                
                // Ë∑≥ËΩ¨Âà∞ÁªìË¥¶Ê≠•È™§
                setTimeout(() => {
                    goToCheckout();
                }, 1000);
            });
            
            optionsContainer.appendChild(checkoutOption);
        }
        
        // Ê≠•È™§4ÔºöÁªìË¥¶
        function showStep4() {
            // ËÆ°ÁÆóÊÄª‰ª∑
            const totalAmount = shoppingCart.reduce((sum, item) => sum + item.totalPrice, 0);
            
            // ÊòæÁ§∫ÁªìË¥¶ÂØπËØù
            addDialogue("salesperson", "ÂîÆË¥ßÂëò", "ÊÇ®‰π∞ÁöÑ‰∏úË•øÔºö", "N√≠n m«éi de d≈çngxi:");
            
            // ÊòæÁ§∫Ë¥≠Áâ©ËΩ¶ÂÜÖÂÆπ
            shoppingCart.forEach(item => {
                const itemText = `${item.quantity}${item.product.measureWord}${item.product.name} - ${item.totalPrice}ÂùóÈí±`;
                const itemPinyin = `${getPinyinForNumber(item.quantity)} ${item.product.measureWord} ${item.product.pinyin} - ${item.totalPrice} ku√†i qi√°n`;
                addDialogue("salesperson", "ÂîÆË¥ßÂëò", itemText, itemPinyin);
            });
            
            // ÊòæÁ§∫ÊÄª‰ª∑
            addDialogue("salesperson", "ÂîÆË¥ßÂëò", `‰∏ÄÂÖ±${totalAmount}ÂùóÈí±„ÄÇ`, `Yƒ´g√≤ng ${totalAmount} ku√†i qi√°n.`);
            
            // Ê∑ªÂä†È°æÂÆ¢‰ªòÊ¨æÂØπËØù
            setTimeout(() => {
                addDialogue("customer", "È°æÂÆ¢", "Â•ΩÁöÑÔºåÁªô‰Ω†Èí±„ÄÇ", "H«éo de, gƒõi n«ê qi√°n.");
                
                // Ê∑ªÂä†ÂîÆË¥ßÂëòÊÑüË∞¢ÂØπËØù
                setTimeout(() => {
                    addDialogue("salesperson", "ÂîÆË¥ßÂëò", "Ë∞¢Ë∞¢ÔºÅÊ¨¢Ëøé‰∏ãÊ¨°ÂÖâ‰∏¥ÔºÅ", "Xi√®xie! HuƒÅny√≠ng xi√†c√¨ guƒÅngl√≠n!");
                    
                    // ÊòæÁ§∫ÂÆåÊàêÂ±èÂπï
                    setTimeout(() => {
                        document.querySelector('.dialogue-container').style.display = 'none';
                        document.querySelector('.options-container').style.display = 'none';
                        document.querySelector('.selection-summary').style.display = 'none';
                        document.querySelector('.controls').style.display = 'none';
                        
                        // ÁîüÊàêÂÆåÊàêÊ∂àÊÅØ
                        let message = "ÊÇ®Ë¥≠‰π∞‰∫ÜÔºö<br><br>";
                        shoppingCart.forEach((item, index) => {
                            message += `<div class="cart-item">
                                <span>${item.product.emoji} ${item.quantity}${item.product.measureWord}${item.product.name}</span>
                                <span>${item.totalPrice}Âùó</span>
                            </div>`;
                        });
                        
                        message += `<div class="cart-total">
                            <span>ÊÄªËÆ°Ôºö</span>
                            <span>${totalAmount}Âùó</span>
                        </div>`;
                        
                        message += "<br>Ë∞¢Ë∞¢ÊÇ®ÁöÑË¥≠‰π∞ÔºÅ";
                        completionMessage.innerHTML = message;
                        completionScreen.style.display = 'block';
                    }, 2000);
                }, 1000);
            }, 1000);
        }
        
        // ËæÖÂä©ÂáΩÊï∞
        function addDialogue(speakerType, speaker, text, pinyin) {
            const dialogue = document.createElement('div');
            dialogue.className = `dialogue ${speakerType}`;
            dialogue.innerHTML = `
                <div class="speaker">${speaker}:</div>
                <div class="text">${text}</div>
                <div class="pinyin">${pinyin}</div>
            `;
            dialogueContainer.appendChild(dialogue);
            
            // ÊªöÂä®Âà∞ÊúÄÊñ∞ÂØπËØù
            dialogueContainer.scrollTop = dialogueContainer.scrollHeight;
        }
        
        function createOptionCard(product, onClick) {
            const card = document.createElement('div');
            card.className = 'option-card';
            card.innerHTML = `
                <div class="emoji">${product.emoji}</div>
                <div class="item-name">${product.name}</div>
                <div class="pinyin">${product.pinyin}</div>
                <div class="item-price">${product.price}Âùó</div>
            `;
            
            card.addEventListener('click', () => {
                // ÁßªÈô§‰πãÂâçÁöÑÈÄâÊã©
                document.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Ê†áËÆ∞ÂΩìÂâçÈÄâÊã©
                card.classList.add('selected');
                onClick();
            });
            
            optionsContainer.appendChild(card);
        }
        
        function getRandomProducts(count, excludeNames) {
            const availableProducts = products.filter(product => !excludeNames.includes(product.name));
            const shuffled = [...availableProducts].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
        
        function getPinyinForNumber(num) {
            const pinyinNumbers = ["yƒ´", "√®r", "sƒÅn", "s√¨", "w«î"];
            return pinyinNumbers[num - 1] || num.toString();
        }
        
        function getChineseNumber(num) {
            const chineseNumbers = ["‰∏Ä", "‰∫å", "‰∏â", "Âõõ", "‰∫î"];
            return chineseNumbers[num - 1] || num.toString();
        }
        
        function updateSelectionSummary() {
            if (shoppingCart.length === 0) {
                selectionSummary.textContent = "Ë¥≠Áâ©ËΩ¶ÊòØÁ©∫ÁöÑ";
                return;
            }
            
            let summary = "";
            shoppingCart.forEach((item, index) => {
                summary += `${item.product.emoji} ${item.quantity}${item.product.measureWord}${item.product.name} - ${item.totalPrice}Âùó<br>`;
            });
            
            // ËÆ°ÁÆóÊÄª‰ª∑
            const totalAmount = shoppingCart.reduce((sum, item) => sum + item.totalPrice, 0);
            summary += `<br><strong>ÊÄªËÆ°: ${totalAmount}Âùó</strong>`;
            
            selectionSummary.innerHTML = summary;
        }
        
        function goToCheckout() {
            currentStep = 4;
            updateStep();
            continueShoppingBtn.style.display = 'none';
            checkoutBtn.style.display = 'none';
        }
        
        // ‰∫ã‰ª∂ÁõëÂê¨Âô®
        continueShoppingBtn.addEventListener('click', () => {
            currentStep = 1;
            updateStep();
            continueShoppingBtn.style.display = 'none';
            checkoutBtn.style.display = 'none';
        });
        
        checkoutBtn.addEventListener('click', goToCheckout);
        
        restartBtn.addEventListener('click', initGame);
        
        newOrderBtn.addEventListener('click', initGame);
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        initGame();
    </script>
</body>
</html>
