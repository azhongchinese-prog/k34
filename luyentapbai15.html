<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyá»‡n Táº­p Cáº¥u TrÃºc æ˜¯...çš„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ThÆ° viá»‡n tá»± Ä‘á»™ng táº¡o Pinyin -->
    <script src="https://unpkg.com/pinyin-pro"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #fdf6e3; /* Pastel yellow background */
            background-image: radial-gradient(#ffd1dc 1px, transparent 1px);
            background-size: 30px 30px;
        }
        .zh-text {
            font-family: 'Noto Sans SC', sans-serif;
        }
        ruby {
            ruby-align: center;
        }
        rt {
            font-size: 0.6em;
            color: #6b7280;
            font-family: 'Nunito', sans-serif;
            font-weight: normal;
            margin-bottom: 2px;
        }
        .pastel-shadow {
            box-shadow: 0 10px 25px -5px rgba(255, 182, 193, 0.4), 0 8px 10px -6px rgba(255, 182, 193, 0.2);
        }
        .btn-hover-effect {
            transition: all 0.2s ease-in-out;
        }
        .btn-hover-effect:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }
        .btn-hover-effect:active {
            transform: translateY(1px);
        }
        
        /* Modal Animation */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 300ms, transform 300ms; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: opacity 300ms, transform 300ms; }
        
        /* Cá»‘ Ä‘á»‹nh 1 hÃ ng chá»¯, cho phÃ©p cuá»™n ngang nhÆ°ng áº©n thanh cuá»™n */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Teacher Edit Buttons (Floating) -->
    <div class="fixed top-4 right-4 flex flex-col gap-3 z-50">
        <button onclick="openEditModal(false)" class="bg-white p-3 rounded-full shadow-md text-xl hover:bg-gray-50 transition" title="Sá»­a cÃ¢u hiá»‡n táº¡i">
            âš™ï¸
        </button>
        <button onclick="openEditModal(true)" class="bg-white p-3 rounded-full shadow-md text-xl hover:bg-green-50 transition text-green-500 font-bold" title="ThÃªm cÃ¢u má»›i">
            â•
        </button>
    </div>

    <!-- App Container -->
    <div class="max-w-2xl w-full bg-white rounded-3xl pastel-shadow overflow-hidden relative" id="app">
        
        <!-- Screen 1: Intro -->
        <div id="intro-screen" class="p-8 md:p-12 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-pink-500 mb-6 drop-shadow-sm">Thá»­ ThÃ¡ch: æ˜¯...çš„</h1>
            <div class="bg-blue-50 rounded-2xl p-6 mb-8 text-left text-gray-700 border border-blue-100">
                <h2 class="text-xl font-bold text-blue-600 mb-3">ğŸ‘‹ HÆ°á»›ng dáº«n chÆ¡i:</h2>
                <ul class="list-disc pl-5 space-y-2">
                    <li>Há»‡ thá»‘ng sáº½ Ä‘Æ°a ra cÃ¡c cÃ¢u há»i vá» <b>Thá»i gian</b>, <b>Äá»‹a Ä‘iá»ƒm</b>, hoáº·c <b>CÃ¡ch thá»©c</b> cá»§a má»™t hÃ nh Ä‘á»™ng Ä‘Ã£ xáº£y ra.</li>
                    <li>Nhiá»‡m vá»¥ cá»§a báº¡n lÃ  <b>NHÃŒN VÃ€ NÃ“I TO</b> cÃ¢u tráº£ lá»i, báº¯t buá»™c pháº£i dÃ¹ng cáº¥u trÃºc <span class="bg-yellow-200 px-2 py-1 rounded text-red-600 font-bold zh-text">æ˜¯ ... çš„</span>.</li>
                    <li>VÃ­ dá»¥: <i>Báº¡n Ä‘áº¿n khi nÃ o?</i> â” NÃ³i to: <i>æˆ‘æ˜¯æ˜¨å¤©æ¥çš„ã€‚</i></li>
                    <li>HÃ£y chÃº Ã½ cÃ¡c tá»« gá»£i Ã½, sau khi tráº£ lá»i xong hÃ£y nháº¥n <b>"Xem ÄÃ¡p Ãn"</b> Ä‘á»ƒ kiá»ƒm tra nhÃ©!</li>
                </ul>
            </div>
            <button onclick="startGame()" class="bg-gradient-to-r from-pink-400 to-rose-400 text-white font-bold text-lg py-4 px-12 rounded-full btn-hover-effect shadow-lg w-full md:w-auto">
                Báº¯t Äáº§u Ngay ğŸš€
            </button>
        </div>

        <!-- Screen 2: Game -->
        <div id="game-screen" class="hidden p-8 md:p-12">
            <!-- Header (Progress & Topic) -->
            <div class="flex justify-between items-center mb-6">
                <span id="topic-badge" class="bg-purple-100 text-purple-700 px-4 py-1.5 rounded-full text-sm font-bold uppercase tracking-wide">
                    Chá»§ Ä‘á»
                </span>
                <span class="text-gray-500 font-semibold">CÃ¢u <span id="current-q-num">1</span>/<span id="total-q-num">?</span></span>
            </div>

            <!-- Question Area -->
            <div class="bg-gray-50 rounded-2xl p-8 mb-8 text-center border-2 border-dashed border-gray-200">
                <div id="question-text" class="text-3xl md:text-4xl font-bold text-gray-800 zh-text mb-4 leading-loose block whitespace-nowrap overflow-x-auto hide-scrollbar pb-4">
                    <!-- Ruby characters injected here -->
                </div>
                <p id="hint-text" class="text-blue-500 font-semibold text-lg mt-4"></p>
            </div>

            <!-- Answer Area (Replaces Input) -->
            <div id="correct-answer-box" class="hidden bg-green-50 text-green-700 border-2 border-green-200 p-8 rounded-2xl text-center mb-8 shadow-inner min-h-[120px] flex items-center justify-center transition-all overflow-hidden">
                <div id="answer-text" class="text-3xl md:text-4xl font-bold zh-text leading-loose block whitespace-nowrap overflow-x-auto hide-scrollbar pb-4 max-w-full">
                    <!-- Target answer ruby injected here -->
                </div>
            </div>

            <!-- Controls -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                <button onclick="toggleAnswer()" id="toggle-ans-btn" class="bg-pink-400 text-white font-bold py-3 px-8 rounded-xl btn-hover-effect shadow-md w-full sm:w-auto text-lg">
                    ğŸ‘ï¸ Xem ÄÃ¡p Ãn
                </button>
                <button onclick="nextQuestion()" id="next-btn" class="bg-blue-400 text-white font-bold py-3 px-8 rounded-xl btn-hover-effect shadow-md w-full sm:w-auto text-lg">
                    CÃ¢u Tiáº¿p Theo â”
                </button>
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="hidden p-12 text-center">
            <div class="text-6xl mb-6">ğŸ‰</div>
            <h2 class="text-3xl font-bold text-green-500 mb-4">HoÃ n thÃ nh xuáº¥t sáº¯c!</h2>
            <p class="text-gray-600 text-lg mb-8">Báº¡n Ä‘Ã£ náº¯m ráº¥t vá»¯ng cáº¥u trÃºc æ˜¯...çš„ rá»“i Ä‘áº¥y!</p>
            <button onclick="resetGame()" class="bg-gradient-to-r from-green-400 to-emerald-400 text-white font-bold text-lg py-4 px-12 rounded-full btn-hover-effect shadow-lg">
                ChÆ¡i Láº¡i Tá»« Äáº§u
            </button>
        </div>
    </div>

    <!-- Teacher Edit Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-lg p-6 shadow-2xl">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-4">âš™ï¸ Chá»‰nh sá»­a cÃ¢u há»i</h3>
            <p class="text-sm text-gray-500 mb-4">Máº¹o: HÃ£y nháº­p tiáº¿ng Trung viáº¿t liá»n (VD: ä½ ä»€ä¹ˆæ—¶å€™æ¥çš„ï¼Ÿ), sau Ä‘Ã³ áº¥n "âœ¨ Tá»± Ä‘á»™ng táº¡o Pinyin".</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Chá»§ Ä‘á»:</label>
                    <input type="text" id="edit-topic" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-200 outline-none">
                </div>
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-sm font-bold text-gray-700">CÃ¢u há»i (Hanzi):</label>
                        <button onclick="autoExtractPinyin('q')" class="text-xs bg-pink-100 text-pink-700 font-bold px-2 py-1 rounded hover:bg-pink-200 transition">âœ¨ Tá»± Ä‘á»™ng táº¡o Pinyin</button>
                    </div>
                    <input type="text" id="edit-q-chars" placeholder="VD: ä½ ä»€ä¹ˆæ—¶å€™æ¥çš„ï¼Ÿ" class="w-full border p-2 rounded zh-text focus:ring-2 focus:ring-blue-200 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">PhiÃªn Ã¢m cÃ¢u há»i (Pinyin):</label>
                    <input type="text" id="edit-q-pinyin" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-200 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Gá»£i Ã½ tráº£ lá»i:</label>
                    <input type="text" id="edit-hint" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-200 outline-none">
                </div>
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-sm font-bold text-gray-700">ÄÃ¡p Ã¡n (Hanzi):</label>
                        <button onclick="autoExtractPinyin('a')" class="text-xs bg-pink-100 text-pink-700 font-bold px-2 py-1 rounded hover:bg-pink-200 transition">âœ¨ Tá»± Ä‘á»™ng táº¡o Pinyin</button>
                    </div>
                    <input type="text" id="edit-a-chars" placeholder="VD: æˆ‘æ˜¯æ˜¨å¤©æ¥çš„ã€‚" class="w-full border p-2 rounded zh-text focus:ring-2 focus:ring-blue-200 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">PhiÃªn Ã¢m Ä‘Ã¡p Ã¡n (Pinyin):</label>
                    <input type="text" id="edit-a-pinyin" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-200 outline-none">
                </div>
            </div>

            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeEditModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">Há»§y</button>
                <button id="save-btn" onclick="saveEdit()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">LÆ°u & Cáº­p nháº­t</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- DATA CÃ‚U Há»I (GIÃO VIÃŠN CÃ“ THá»‚ Äá»”I Táº I ÄÃ‚Y Náº¾U MUá»N Äá»”I Máº¶C Äá»ŠNH) ---
        let questions = [
            {
                topic: "Thá»i gian",
                charArr: "ä½  ä»€ ä¹ˆ æ—¶ å€™ æ¥ çš„ ï¼Ÿ",
                pinyinArr: "nÇ shÃ©n me shÃ­ hÃ²u lÃ¡i de ?",
                hint: "Gá»£i Ã½: DÃ¹ng æ˜¨å¤© (HÃ´m qua)",
                ansCharArr: "æˆ‘ æ˜¯ æ˜¨ å¤© æ¥ çš„ ã€‚",
                ansPinyinArr: "wÇ’ shÃ¬ zuÃ³ tiÄn lÃ¡i de ."
            },
            {
                topic: "Äá»‹a Ä‘iá»ƒm",
                charArr: "è¿™ ä¸ª æ˜¯ åœ¨ å“ªå„¿ ä¹° çš„ ï¼Ÿ",
                pinyinArr: "zhÃ¨ ge shÃ¬ zÃ i nÇ'er mÇi de ?",
                hint: "Gá»£i Ã½: DÃ¹ng åœ¨åŒ—äº¬ (á» Báº¯c Kinh)",
                ansCharArr: "è¿™ æ˜¯ åœ¨ åŒ— äº¬ ä¹° çš„ ã€‚",
                ansPinyinArr: "zhÃ¨ shÃ¬ zÃ i bÄ›i jÄ«ng mÇi de ."
            },
            {
                topic: "CÃ¡ch thá»©c",
                charArr: "ä½  ä»¬ æ˜¯ æ€ ä¹ˆ æ¥ é¥­ åº— çš„ ï¼Ÿ",
                pinyinArr: "nÇ men shÃ¬ zÄ›n me lÃ¡i fÃ n diÃ n de ?",
                hint: "Gá»£i Ã½: DÃ¹ng åå‡ºç§Ÿè½¦ (Ngá»“i taxi) hoáº·c åè½¦ (Äi xe)",
                ansCharArr: "æˆ‘ ä»¬ æ˜¯ å å‡º ç§Ÿ è½¦ æ¥ çš„ ã€‚",
                ansPinyinArr: "wÇ’ men shÃ¬ zuÃ² chÅ« zÅ« chÄ“ lÃ¡i de ."
            },
            {
                topic: "Thá»i gian",
                charArr: "ä½  ä»¬ æ˜¯ ä»€ ä¹ˆ æ—¶ å€™ è®¤ è¯† çš„ ï¼Ÿ",
                pinyinArr: "nÇ men shÃ¬ shÃ©n me shÃ­ hÃ²u rÃ¨n shÃ­ de ?",
                hint: "Gá»£i Ã½: DÃ¹ng 2011å¹´9æœˆ (ThÃ¡ng 9 nÄƒm 2011)",
                ansCharArr: "æˆ‘ ä»¬ æ˜¯ 2011 å¹´ 9 æœˆ è®¤ è¯† çš„ ã€‚",
                ansPinyinArr: "wÇ’ men shÃ¬ 2011 niÃ¡n 9 yuÃ¨ rÃ¨n shÃ­ de ."
            },
            {
                topic: "Thá»i gian (Má»Ÿ rá»™ng)",
                charArr: "æ˜ å¤© æ˜¯ 2014 å¹´ 5 æœˆ 11 æ—¥ å— ï¼Ÿ",
                pinyinArr: "mÃ­ng tiÄn shÃ¬ 2014 niÃ¡n 5 yuÃ¨ 11 rÃ¬ ma ?",
                hint: "Tráº£ lá»i: ÄÃºng, ngÃ y mai lÃ ...",
                ansCharArr: "æ˜¯ çš„ ï¼Œ æ˜ å¤© æ˜¯ 2014 å¹´ 5 æœˆ 11 æ—¥ ã€‚",
                ansPinyinArr: "shÃ¬ de , mÃ­ng tiÄn shÃ¬ 2014 niÃ¡n 5 yuÃ¨ 11 rÃ¬ ."
            }
        ];

        // --- STATE ---
        let currentIndex = 0;
        let isAnswerShown = false;
        let isEditingNew = false; // Theo dÃµi xem Ä‘ang sá»­a hay táº¡o má»›i

        // --- DOM ELEMENTS ---
        const introScreen = document.getElementById('intro-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const qTextDiv = document.getElementById('question-text');
        const hintText = document.getElementById('hint-text');
        const topicBadge = document.getElementById('topic-badge');
        const currentQNum = document.getElementById('current-q-num');
        const totalQNum = document.getElementById('total-q-num');
        const correctAnswerBox = document.getElementById('correct-answer-box');
        const answerTextDiv = document.getElementById('answer-text');
        const nextBtn = document.getElementById('next-btn');
        const toggleAnsBtn = document.getElementById('toggle-ans-btn');

        // --- FUNCTIONS ---
        // Helper function to render Hanzi + Pinyin HTML
        function generateRubyHTML(charString, pinyinString) {
            let html = '';
            // Sá»­ dá»¥ng regex /\s+/ Ä‘á»ƒ phÃ²ng há» giÃ¡o viÃªn lá»¡ tay gÃµ nhiá»u dáº¥u cÃ¡ch
            const chars = charString.trim().split(/\s+/);
            const pinyins = pinyinString.trim().split(/\s+/);
            
            for(let i = 0; i < chars.length; i++) {
                if(/^[ï¼Ÿ\?ï¼Œ,\.ã€‚ï¼!]$/.test(chars[i])) {
                     html += `<span class="mt-4">${chars[i]}</span>`;
                } else {
                    // Náº¿u giÃ¡o viÃªn quÃªn nháº­p Pinyin, tá»± Ä‘á»™ng chÃ¨n khoáº£ng tráº¯ng tÃ ng hÃ¬nh Ä‘á»ƒ giá»¯ khung
                    const pinyinText = pinyins[i] ? pinyins[i] : '&nbsp;';
                    html += `
                        <ruby class="mx-0.5">
                            ${chars[i]}
                            <rt>${pinyinText}</rt>
                        </ruby>
                    `;
                }
            }
            return html;
        }

        function startGame() {
            introScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            totalQNum.innerText = questions.length;
            loadQuestion();
        }

        function loadQuestion() {
            resetUI();
            const q = questions[currentIndex];
            currentQNum.innerText = currentIndex + 1;
            topicBadge.innerText = `ğŸ“ Chá»§ Ä‘á»: ${q.topic}`;
            hintText.innerText = q.hint;
            
            // Render Ruby Pinyin for Question
            qTextDiv.innerHTML = generateRubyHTML(q.charArr, q.pinyinArr);
            
            // Render Ruby Pinyin for Answer
            answerTextDiv.innerHTML = generateRubyHTML(q.ansCharArr, q.ansPinyinArr);
        }

        function resetUI() {
            correctAnswerBox.classList.add('hidden');
            toggleAnsBtn.innerText = "ğŸ‘ï¸ Xem ÄÃ¡p Ãn";
            isAnswerShown = false;
        }

        function toggleAnswer() {
            isAnswerShown = !isAnswerShown;
            if (isAnswerShown) {
                correctAnswerBox.classList.remove('hidden');
                toggleAnsBtn.innerText = "ğŸ™ˆ áº¨n ÄÃ¡p Ãn";
            } else {
                correctAnswerBox.classList.add('hidden');
                toggleAnsBtn.innerText = "ğŸ‘ï¸ Xem ÄÃ¡p Ãn";
            }
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < questions.length) {
                loadQuestion();
            } else {
                gameScreen.classList.add('hidden');
                endScreen.classList.remove('hidden');
                
                // Reset styling for the next play
                nextBtn.innerText = "CÃ¢u Tiáº¿p Theo â”";
                nextBtn.classList.remove('bg-green-500');
                nextBtn.classList.add('bg-blue-400');
            }

            // If it is the last question, change next button text
            if (currentIndex === questions.length - 1) {
                nextBtn.innerText = "HoÃ n thÃ nh ğŸ†";
                nextBtn.classList.remove('bg-blue-400');
                nextBtn.classList.add('bg-green-500');
            }
        }

        function resetGame() {
            currentIndex = 0;
            endScreen.classList.add('hidden');
            startGame();
        }

        // --- Tá»° Äá»˜NG Táº O PINYIN ---
        function autoExtractPinyin(type) {
            const hanziInput = document.getElementById(type === 'q' ? 'edit-q-chars' : 'edit-a-chars');
            const pinyinInput = document.getElementById(type === 'q' ? 'edit-q-pinyin' : 'edit-a-pinyin');
            
            // Láº¥y chá»¯ HÃ¡n vÃ  xÃ³a khoáº£ng tráº¯ng thá»«a náº¿u cÃ³
            const rawText = hanziInput.value.replace(/\s+/g, '');
            if (!rawText) return;

            const chars = rawText.split('');
            const hanziRes = [];
            const pinyinRes = [];

            chars.forEach(char => {
                hanziRes.push(char);
                // DÃ¹ng pinyinPro Ä‘á»ƒ dá»‹ch tá»«ng chá»¯, náº¿u lÃ  dáº¥u cÃ¢u thÃ¬ giá»¯ nguyÃªn
                if (/[\u4e00-\u9fa5]/.test(char)) {
                    pinyinRes.push(window.pinyinPro.pinyin(char));
                } else {
                    pinyinRes.push(char);
                }
            });

            // Cáº­p nháº­t láº¡i khung input (thÃªm khoáº£ng tráº¯ng chuáº©n)
            hanziInput.value = hanziRes.join(' ');
            pinyinInput.value = pinyinRes.join(' ');
        }

        // --- TEACHER EDIT FUNCTIONS ---
        const editModal = document.getElementById('edit-modal');
        
        function openEditModal(isNew = false) {
            isEditingNew = isNew;

            if (gameScreen.classList.contains('hidden') && endScreen.classList.contains('hidden') && !isNew) {
                alert("HÃ£y áº¥n Báº¯t Äáº§u trÆ°á»›c khi chá»‰nh sá»­a cÃ¢u há»i hiá»‡n táº¡i.");
                return;
            }
            
            if (isNew) {
                // XÃ³a tráº¯ng form Ä‘á»ƒ thÃªm má»›i
                document.getElementById('modal-title').innerText = 'âœ¨ ThÃªm cÃ¢u há»i má»›i';
                document.getElementById('save-btn').innerText = 'ThÃªm vÃ o danh sÃ¡ch';
                document.getElementById('edit-topic').value = 'Má»Ÿ rá»™ng';
                document.getElementById('edit-q-chars').value = '';
                document.getElementById('edit-q-pinyin').value = '';
                document.getElementById('edit-hint').value = '';
                document.getElementById('edit-a-chars').value = '';
                document.getElementById('edit-a-pinyin').value = '';
            } else {
                // Táº£i dá»¯ liá»‡u cÃ¢u hiá»‡n táº¡i
                if (!endScreen.classList.contains('hidden')) {
                    currentIndex = 0; // Äáº·t láº¡i index náº¿u Ä‘ang á»Ÿ mÃ n káº¿t
                }
                const q = questions[currentIndex];
                document.getElementById('modal-title').innerText = 'âš™ï¸ Chá»‰nh sá»­a cÃ¢u há»i hiá»‡n táº¡i';
                document.getElementById('save-btn').innerText = 'LÆ°u & Cáº­p nháº­t';
                document.getElementById('edit-topic').value = q.topic;
                document.getElementById('edit-q-chars').value = q.charArr;
                document.getElementById('edit-q-pinyin').value = q.pinyinArr;
                document.getElementById('edit-hint').value = q.hint;
                document.getElementById('edit-a-chars').value = q.ansCharArr;
                document.getElementById('edit-a-pinyin').value = q.ansPinyinArr;
            }
            
            editModal.classList.remove('hidden');
        }

        function closeEditModal() {
            editModal.classList.add('hidden');
        }

        function saveEdit() {
            const newQuestionData = {
                topic: document.getElementById('edit-topic').value,
                charArr: document.getElementById('edit-q-chars').value,
                pinyinArr: document.getElementById('edit-q-pinyin').value,
                hint: document.getElementById('edit-hint').value,
                ansCharArr: document.getElementById('edit-a-chars').value,
                ansPinyinArr: document.getElementById('edit-a-pinyin').value
            };

            if (isEditingNew) {
                questions.push(newQuestionData);
                currentIndex = questions.length - 1; // Chuyá»ƒn Ä‘áº¿n ngay cÃ¢u vá»«a táº¡o
                totalQNum.innerText = questions.length;
                
                // Náº¿u Ä‘ang á»Ÿ mÃ n hÃ¬nh káº¿t thÃºc, quay láº¡i mÃ n game
                if (!endScreen.classList.contains('hidden')) {
                    endScreen.classList.add('hidden');
                    gameScreen.classList.remove('hidden');
                }
            } else {
                questions[currentIndex] = newQuestionData;
            }
            
            closeEditModal();
            loadQuestion(); // Reload current question to show changes
            
            // Hiá»‡u á»©ng nÃºt xanh xÃ¡c nháº­n
            const btn = isEditingNew ? document.querySelector('button[title="ThÃªm cÃ¢u má»›i"]') : document.querySelector('button[title="Sá»­a cÃ¢u hiá»‡n táº¡i"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = "âœ…";
            setTimeout(() => btn.innerHTML = originalText, 1500);
        }

        // --- KEYBOARD SHORTCUTS FOR FASTER PRACTICE ---
        document.addEventListener('keydown', (e) => {
            // Disable shortcuts if screen is hidden or modal is open
            if (gameScreen.classList.contains('hidden')) return;
            if (!editModal.classList.contains('hidden')) return;
            
            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault(); // Prevent page scroll on spacebar
                if (!isAnswerShown) {
                    toggleAnswer();
                } else {
                    nextQuestion();
                }
            }
        });

    </script>
</body>
</html>
